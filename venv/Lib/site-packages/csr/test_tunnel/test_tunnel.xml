<?xml version="1.0"?>
<!--
  Hydra Test Tunnel Protocol message definitions.

  CONFIDENTIAL

Copyright (c) 2015 - 2016 Qualcomm Technologies International, Ltd.
  

  DESCRIPTION

    Message definitions for the Test Tunnel Protocol signalling in
    Hydra chips.

  REFERENCES

    TBD
-->

<definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:noNamespaceSchemaLocation=".\hip.xsd">

   <resource name="FILE"/>
   <type name="CoreTypesXml" resource="FILE" file="core_types.xml"/>
   <type name="AccmdXml"     resource="FILE" file="accmd.xml"/>
   
   <resource name="CONST"/>
   <resource name="TYPE"/>

   <resource name="PRIMITIVE"/>
   <resource name="HEADER"/>

   <type name="VAR_LEN_ARRAY_8" resource="TYPE">
     <field name="Elements" blocklength="">
       <type>uint8</type>
     </field>
   </type>

  <!--  ****************************************************************  -->
  <!--  *************         Test tunnel Messages          ************  -->
  <!--  ****************************************************************  -->

    <!-- A test tunnel message consists of a header of fixed type and payload
    of a type determined by the Tunnel_Id in the header -->
    <type name="Test_Tunnel_Message" resource="PRIMITIVE">
      <field name="header">
        <type>Test_Tunnel_Header</type>
      </field>
      <field name="payload" discriminant="&amp;header.Tunnel_Id">
        <resource>Test_Tunnel_Payload</resource>
      </field>
    </type>

    <type name="Test_Tunnel_Header" resource="TYPE">
      <field name="Tunnel_Id">
        <type>Test_Tunnel_Id</type>
      </field>
      <field name="reserved" hidden="true">
        <type>uint8</type>
      </field>
      <field name="padding_bytes">
        <type>uint2</type>
      </field>
      <field name="reserved2" hidden="true">
        <type>uint14</type>
      </field>
    </type>
    
    <!-- Test_Tunnel_Id is an enumeration including the following values: -->
    <type name="Test_Tunnel_Id" resource="TYPE" size="8">
      <value name="accmd"           value="6"/>
      <value name="audio_data"      value="7"/>
    </type>

    <!-- The mapping from Test_Tunnel_Ids to the corresponding payload is as
         follows: -->
    <resource name="Test_Tunnel_Payload" discriminant="Test_Tunnel_Id">
      <rmap dvalue="accmd"              type="ACCMD_Message"/>
      <rmap dvalue="audio_data"         type="TEST_TUNNEL_AUDIO_TRANSPORT"/>
    </resource>

    <type name="TEST_TUNNEL_CONTROL" resource="TYPE">
      <field name="control_id">
        <type>TEST_TUNNEL_CONTROL_ID</type>
      </field>
      <field name="tunnel_id">
        <type>Test_Tunnel_Id</type>
      </field>
      <field name="payload" discriminant="&amp;control_id">
        <resource>Test_Tunnel_Control_Payload</resource>
      </field>
    </type>
    
    <type name="TEST_TUNNEL_CONTROL_ID" resource="TYPE" size="16">
      <value name="connect_req"     value="0"/>
      <value name="connect_rsp"     value="1"/>
      <value name="disconnect_req"  value="2"/>
      <value name="disconnect_rsp"  value="3"/>
    </type>

    <resource name="Test_Tunnel_Control_Payload" discriminant="TEST_TUNNEL_CONTROL_ID">
      <rmap dvalue="connect_rsp"    type="TEST_TUNNEL_CONTROL_RSP"/>
      <rmap dvalue="disconnect_rsp" type="TEST_TUNNEL_CONTROL_RSP"/>
    </resource>
   
    <type name="TEST_TUNNEL_CONTROL_RSP" resource="TYPE">
      <field name="response">
        <type>Test_Tunnel_Response_Code</type>
      </field>
      <field name="padding" hidden="true">
        <type>uint16</type>
      </field>
    </type>
    
    <type name="Test_Tunnel_Response_Code" resource="TYPE" size="16">
       <value name="SUCCESS"                   value="0"/>
       <value name="INVALID_PARAMETERS"        value="1"/>
       <value name="INVALID_STATE"             value="2"/>
       <value name="UNKNOWN_COMMAND"           value="3"/>
       <value name="UNIMPLEMENTED"             value="4"/>
    </type>
    
    <!-- Test tunnel payloads are simply opaque variable-length octet arrays -->
    <type name="TEST_TUNNEL_GENERIC_PAYLOAD" resource="TYPE">
      <field name="data" blocklength="">
         <type>uint8</type>
      </field>
    </type>

    <type name="TEST_TUNNEL_AUDIO_TRANSPORT" resource="TYPE">
        <field name="type">
            <type>TEST_TUNNEL_AUDIO_PKT_TYPE</type>
        </field>
        <field name="payload" discriminant="&amp;type">
            <resource>Test_Tunnel_Audio_Payload</resource>
        </field>
    </type>
    
    <type name="TEST_TUNNEL_AUDIO_PKT_TYPE" resource="TYPE" size="16">
        <value name="Data"              value="0"/>
        <value name="Create_Link_Req"   value="1"/>
        <value name="Create_Cfm"        value="2"/>
        <value name="Destroy_Link_Req"  value="3"/>
        <value name="Destroy_Cfm"       value="4"/>
        <value name="Flow_Control_Req"  value="5"/>
        <value name="Flow_Control_Ind"  value="6"/>
        <value name="DataFrame"         value="7"/>
        <value name="TimedDataFrame"    value="8"/>
    </type>
    
    <resource name="Test_Tunnel_Audio_Payload" discriminant="TEST_TUNNEL_AUDIO_PKT_TYPE">
        <rmap dvalue="Data"             type="TEST_TUNNEL_AUDIO_DATA"/>
        <rmap dvalue="Create_Link_Req"  type="TEST_TUNNEL_AUDIO_CREATE_REQ"/>
        <rmap dvalue="Destroy_Link_Req" type="TEST_TUNNEL_AUDIO_DESTROY_REQ"/>
        <rmap dvalue="Create_Cfm"       type="TEST_TUNNEL_AUDIO_CREATE_CFM"/>
        <rmap dvalue="Destroy_Cfm"      type="TEST_TUNNEL_AUDIO_DESTROY_CFM"/>
        <rmap dvalue="Flow_Control_Req" type="TEST_TUNNEL_AUDIO_FLOW_REQ"/>
        <rmap dvalue="Flow_Control_Ind" type="TEST_TUNNEL_AUDIO_FLOW_IND"/>
        <rmap dvalue="DataFrame"        type="TEST_TUNNEL_AUDIO_DATA_FRAME"/>
        <rmap dvalue="TimedDataFrame"   type="TEST_TUNNEL_AUDIO_TIMED_DATA_FRAME"/>
    </resource>

    <type name="TEST_TUNNEL_AUDIO_DATA" resource="TYPE">
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
        <field name="payload" blocklength="">
            <type>uint8</type>
        </field>
    </type>
        
    <type name="TEST_TUNNEL_AUDIO_DATA_FRAME" resource="TYPE">
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
        <field name="pkt_boundary">
            <type>Bit</type>
        </field>
        <field name="spare" hidden="true">
            <type>uint7</type>
        </field>
        <field name="header_len" hidden="true">
            <type>uint8</type>
        </field>
        <field name="header" blocklength="header_len">
            <type>uint8</type>
        </field>
        <field name="payload" blocklength="">
            <type>uint8</type>
        </field>
    </type>
        
    <type name="TEST_TUNNEL_AUDIO_TIMED_DATA_FRAME" resource="TYPE">
        <field name="presentation_time">
            <type>uint32</type>
        </field>
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
        <field name="pkt_boundary">
            <type>Bit</type>
        </field>
        <field name="spare" hidden="true">
            <type>uint7</type>
        </field>
        <field name="header_len" hidden="true">
            <type>uint8</type>
        </field>
        <field name="header" blocklength="header_len">
            <type>uint8</type>
        </field>
        <field name="payload" blocklength="">
            <type>uint8</type>
        </field>
    </type>

    <type name="Accmd_Types_Xml" resource="FILE" file="accmd_types.xml" />
    
    <type name="TEST_TUNNEL_AUDIO_CREATE_REQ" resource="TYPE">
        <field name="sink">
            <type>uint8</type>
        </field>
        <field name="hdrlen">
            <type>uint8</type>
        </field>
        <field name="type">
            <type>Accmd_Stream_Device</type>
        </field>
        <field name="connected_endpoint_id">
            <type>uint16</type>
        </field>
        <field name="params" blocklength="">
            <type>uint16</type>
        </field>
    </type>
    
    <type name="TEST_TUNNEL_AUDIO_CREATE_CFM" resource="TYPE">
        <field name="response">
            <type>Test_Tunnel_Response_Code</type>
        </field>
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
        <field name="available_bytes">
            <type>uint16</type>
        </field>
    </type>
    
    <type name="TEST_TUNNEL_AUDIO_DESTROY_REQ" resource="TYPE">
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
    </type>
    
    <type name="TEST_TUNNEL_AUDIO_DESTROY_CFM" resource="TYPE">
        <field name="response">
            <type>Test_Tunnel_Response_Code</type>
        </field>
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
    </type>

    <type name="TEST_TUNNEL_AUDIO_FLOW_REQ" resource="TYPE">
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
    </type>
    
    <type name="TEST_TUNNEL_AUDIO_FLOW_IND" resource="TYPE">
        <field name="endpoint_id">
            <type>uint16</type>
        </field>
        <field name="bytes_consumed">
            <type>uint16</type>
        </field>
        <field name="available_bytes">
            <type>uint16</type>
        </field>
        <field name="pkts_consumed">
            <type>uint16</type>
        </field>
        <field name="available_pkts">
            <type>uint16</type>
        </field>
    </type>
    
</definitions>
